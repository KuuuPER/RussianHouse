@using System.Web.Services.Description
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>@ViewBag.Title</title>
    <link href="~/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
    <link href='http://webfonts.ru/import/vremena.css' rel='stylesheet' type='text/css'>
    <link href='/Content/bootstrap-responsive.min.css' rel='stylesheet' type='text/css'>
    <link href='/Content/bootstrap.min.css' rel='stylesheet' type='text/css'>
    <meta name="viewport" content="width=device-width"/>
    <script type="text/javascript" src="//vk.com/js/api/openapi.js?116"></script>
    <script type="text/javascript" src="/Scripts/bootstrap.min.js"></script>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    @Scripts.Render("~/")
</head>
<body>
<div id="payAndTerms">
    <div id="form1" class="yaForm">
        <iframe frameborder="0" allowtransparency="true" scrolling="no" src="https://money.yandex.ru/embed/shop.xml?account=410011626723042&quickpay=shop&payment-type-choice=on&writer=seller&targets=%D0%91%D0%B5%D0%B7%D0%B2%D0%BE%D0%B7%D0%BC%D0%B5%D0%B7%D0%B4%D0%BD%D0%BE%D0%B5+%D0%B4%D0%B0%D1%80%D0%B5%D0%BD%D0%B8%D0%B5&targets-hint=&default-sum=500&button-text=01&mail=on&successURL=" width="450" height="198"></iframe>
    </div>
    <div id="form2" class="yaForm">
        <iframe frameborder="0" allowtransparency="true" scrolling="no" src="https://money.yandex.ru/embed/shop.xml?account=410011626723042&quickpay=shop&payment-type-choice=on&writer=seller&targets=%D0%91%D0%B5%D0%B7%D0%B2%D0%BE%D0%B7%D0%BC%D0%B5%D0%B7%D0%B4%D0%BD%D0%BE%D0%B5+%D0%B4%D0%B0%D1%80%D0%B5%D0%BD%D0%B8%D0%B5&targets-hint=&default-sum=1000&button-text=01&mail=on&successURL=" width="450" height="198"></iframe>
    </div>
    <div id="form3" class="yaForm">
        <iframe frameborder="0" allowtransparency="true" scrolling="no" src="https://money.yandex.ru/embed/shop.xml?account=410011626723042&quickpay=shop&payment-type-choice=on&writer=seller&targets=%D0%91%D0%B5%D0%B7%D0%B2%D0%BE%D0%B7%D0%BC%D0%B5%D0%B7%D0%B4%D0%BD%D0%BE%D0%B5+%D0%B4%D0%B0%D1%80%D0%B5%D0%BD%D0%B8%D0%B5&targets-hint=&default-sum=2000&button-text=01&mail=on&successURL=" width="450" height="198"></iframe>
    </div>
    <div id="form4" class="yaForm">
        <iframe frameborder="0" allowtransparency="true" scrolling="no" src="https://money.yandex.ru/embed/shop.xml?account=410011626723042&quickpay=shop&payment-type-choice=on&writer=seller&targets=%D0%91%D0%B5%D0%B7%D0%B2%D0%BE%D0%B7%D0%BC%D0%B5%D0%B7%D0%B4%D0%BD%D0%BE%D0%B5+%D0%B4%D0%B0%D1%80%D0%B5%D0%BD%D0%B8%D0%B5&targets-hint=&default-sum=1000&button-text=01&mail=on&successURL=" width="450" height="198"></iframe>
    </div>
    <div id="terms">
        <div id="textTerms">
            <p>
                Уточнить точный текст у Влада. Отправляя нам деньжата, вы должны согласится с <a>условия тыры-пыры</a>
            </p>
        </div>
        <div id="acceptTerms">
            <input type="checkbox"/>
            <p>Я согласен с чем-то там</p>
        </div>
    </div>
</div>
<div id="overlay" onclick="closeModal();"></div>
<div id="page" class="container">
    <header>
        <div id="head" class="centerContent">
            <div id="money">
                <div id="currentSumBorder" class="border textCenter">
                    <div id="currentSum">
                        <p>
                            Собрано <b id="gettedSum">10 000</b> рублей из <b>2 500 000</b>
                        </p>
                    </div>
                </div>
                <div id="projectHelpBorder" value="GetFundRisingContent">
                    <div id="projectHelp" class="orangeFill">
                        <p>
                            <b><i>Помочь проекту!</i></b>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div id="logoMenu">
            <div id="logo">
            </div>
            <div id="navDivPic" class="centerContent container">
                <div id="navDiv">
                    <nav id="menu">
                        <ul>
                            <li id="aboutProject" value="GetAboutProjectContent">О проекте</li>
                            <li id="fundRising" value="GetFundRisingContent">Сбор средств</li>
                            <li id="news" value="GetNewsContent">Новости</li>
                            <li id="team" value="GetTeamContent">Команда</li>
                            <li id="partners" value="GetPartnersContent">Партнёры</li>
                            <li id="contacts" value="GetContactsContent">Контакты</li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>
    @RenderSection("featured", required: false)
    @RenderBody()
    <footer>
        <div>
        </div>
    </footer>
</div>

@Scripts.Render("~/bundles/jquery")
@RenderSection("scripts", required: false)
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
</body>
<script type="text/javascript">
    {
        getBalance();
        markNav();
        $('#overlay').hide();
        $('#payAndTerms').hide();

        function openModal(elem) {
            var element = $(elem);
            var formId = 'form' + $(element.parent('div').parent('div')).attr('value');
                $('#overlay').fadeTo(400, 0.8,
                    function () {
                        $('#payAndTerms').css('display', 'block');
                        $('#payAndTerms').attr('value', formId);
                        $('#' + formId).css('display', 'inline-block');
                        $('#payAndTerms').animate({ opacity: 1, top: '50%' }, 200);
                    });
        }

        function closeModal() { // ловим клик по крестику или подложке
                $('#payAndTerms').animate({ opacity: 0, top: '45%' }, 200,  // плавно меняем прозрачность на 0 и одновременно двигаем окно вверх
                        function () { // после анимации
                            $(this).css('display', 'none'); // делаем ему display: none;
                            $('#overlay').fadeOut(400);
                            $('#payAndTerms').fadeOut(400);
                            var val = $('#payAndTerms').attr('value');
                            $('#' + val).fadeOut(400);
                        }
                    );
            }

        function markNav() {
            if (document.location.pathname === '/') {
                $($('#menu ul li')[0]).addClass("active");
            } else {
                var currentPage = document.location.pathname.split('/')[2];

                var lis = $('ul li');

                for (var i = 0; i < lis.length; i++) {
                    var li = lis[i];

                    if (li.getAttribute('value') === currentPage) {
                        $(li).addClass("active");
                    } else {
                        $(li).removeClass("active");
                    }
                }
            }

            var content = $('#content');
            var lowerContent = $('#lowerContent');

            if (content.height() < 700) {
                content.height(700);
                lowerContent.height(465);
            }
        }

        $('#projectHelpBorder').click(getContent);
        $('#menu ul li').click(getContent);
        $('#menu ul li').click(getContent);

        function getContent() {
            getBalance();

            var elem = this;
            var li = $('#menu ul .active');

            $(li).removeClass("active");

            $(elem).addClass("active");
            var titleText = elem.textContent;
            var value = elem.getAttribute('value');
            var path = "/Home/" + value;

            history.pushState(null, titleText, path);
            $.get(path, { isPartial: true }).done(function(data) {
                $('#content').replaceWith(data);
                $('#content').replaceWith(data);
                markNav();
            });
        }

        function getBalance() {
            $.get("/Home/GetBalance").done(function (data) {
                if (data !== null) {
                    $("#gettedSum").text(data);
                }
            });
        }

        $(window).on('popstate', function(e) {
            updateState();
        });

        function updateState() {
            var path = document.location.pathname;

            $.get(path, { isPartial: true }).done(function(data) {
                $('#content').replaceWith(data);
                markNav();
            });
        }
    }
</script>
</html>
